<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml"
	width="100%"
	height="97%" 
	label="Models"
  xmlns:rx="org.restfulx.components.rx.*" xmlns:code="http://code.google.com/p/flexlib/">
  <mx:Script><![CDATA[
  	import rxui.models.ModelAttribute;
    import org.restfulx.Rx;
    import org.restfulx.utils.RxUtils;
    import rxui.models.ModelObject;
    import rxui.models.Project;

    [Bindable]
    private var _modelObject:ModelObject = new ModelObject();

    private function newModelObject():void {
      _modelObject = new ModelObject();
      modelObjectsList.selectedIndex = -1;
      attributesDataGrid.dataProvider = new Array();
    }

    private function saveModelObject():void {
      if (_modelObject.id) {
        updateModelObject();
      } else {
        createModelObject();
      }
    }
  
    private function createModelObject():void {
      var modelObject:ModelObject = new ModelObject();
      modelObject.name = nameTextInput.text;

      modelObject.create({onSuccess: onModelObjectCreate});
    }

    private function updateModelObject():void {
      _modelObject.name = nameTextInput.text;

      _modelObject.update({onSuccess: onModelObjectUpdate});
    }

    private function destroyModelObject():void {
      _modelObject.destroy({onSuccess: onModelObjectDestroy});
    }
  
    private function onModelObjectSelect():void {
      _modelObject = RxUtils.clone(modelObjectsList.selectedItem) as ModelObject;
      attributesDataGrid.dataProvider = _modelObject.modelAttributes;
    }
  
    private function onModelObjectCreate(modelObject:ModelObject):void {
      _modelObject = modelObject;
      attributesDataGrid.dataProvider = _modelObject.modelAttributes;
    }
  
    private function onModelObjectUpdate(modelObject:ModelObject):void {
      modelObjectsList.selectedItem = modelObject;
      _modelObject = RxUtils.clone(modelObject) as ModelObject;
    }
  
    private function onModelObjectDestroy(modelObject:ModelObject):void {
      onModelObjectCreate(modelObject);
      nameTextInput.text = "";
      attributesDataGrid.dataProvider = new Array();
    }

    private function canDeleteModelObject(modelObject:ModelObject):Boolean {
      return modelObject != null && !RxUtils.isEmpty(modelObject.id);
    }
    
    ////
    //attributes
    
    private function saveModelAttribute():void {
      var modelAttribute:ModelAttribute = new ModelAttribute();
      modelAttribute.name = nameMATI.text;
      modelAttribute.modelObject = _modelObject;

      modelAttribute.create({onSuccess: onModelAttributeCreate});
    }
    
    private function onModelAttributeCreate(modelAttribute:ModelAttribute):void {
    	nameMATI.text = "";
      attributesDataGrid.dataProvider = _modelObject.modelAttributes;
    }
    
    
  ]]></mx:Script>
  <mx:VBox height="100%" width="25%">
    <mx:ControlBar width="100%">
      <mx:Button label="New Model" width="100%" height="40"
      	icon="@Embed(source='assets/icons/32/file_add.png')"
        click="newModelObject()"/>
    </mx:ControlBar>
    <mx:List id="modelObjectsList"
      width="100%" height="100%" fontSize="13"
      borderThickness="3" borderColor="#ffffff"
      dataProvider="{Rx.models.index(ModelObject)}"
      change="onModelObjectSelect()"/>
  </mx:VBox>
  <mx:VBox height="100%" width="73%">
  	<mx:ControlBar width="100%">
    	<mx:Spacer width="3"/>
    	<code:PromptingTextInput id="nameTextInput" width="150" color="#000000"
  			prompt="Name" text="{_modelObject.name}" height="34" fontSize="22"/>
      <mx:Button label="Save Model" height="40"
      	icon="@Embed(source='assets/icons/32/file_edit.png')"
        click="saveModelObject()"/>
      <mx:Button label="Delete Model" height="40"
      	icon="@Embed(source='assets/icons/32/file_delete.png')"
        enabled="{canDeleteModelObject(_modelObject)}"
        click="destroyModelObject()"/>
    </mx:ControlBar>
	  <mx:Spacer width="3"/>
  	<mx:ControlBar width="100%">
  		<code:PromptingTextInput id="nameMATI" width="150" color="#000000"
  			prompt="Name"/>
      <mx:Button label="Create Attribute" height="30"
        click="saveModelAttribute()"/>
      <!--<mx:Button label="Delete Attribute" width="50%" height="30"
        enabled="{canDeleteModelObject(_modelObject)}"
        click="destroyModelAttribute()"/>-->
    </mx:ControlBar>
    <mx:DataGrid id="attributesDataGrid"
    	headerColors="#f35600" headerHeight="24"
			horizontalScrollPolicy="off" fontSize="14"
			variableRowHeight="true" wordWrap="true"
			height="100%" right="25" top="45" left="5" width="100%">
			<mx:columns>
				<mx:DataGridColumn dataField="name" headerText="Attribute Name"/>
			</mx:columns>
		</mx:DataGrid>
  </mx:VBox>
</mx:HBox>

<!--project:
 - name:  string
 - notes: text
 - path:  string
 - has_many: [model_objects]
 
model_object:
 - has_many: [model_attributes, layouts]
 - belongs_to: [project]
 - name: string
 
model_attribute:
 - name: string
 - attribute_type: string
 - attribute_length: integer
 - belongs_to: [model_object]
 
layout:
 - name: string
 - belongs_to: [model_object]-->